<!DOCTYPE html>
<html lang="zh-Hans" dir="ltr" class="scroll-smooth" data-default-appearance="dark"
  data-auto-appearance="true"><head>
  <meta charset="utf-8" />
  
  <meta http-equiv="content-language" content="zh-Hans" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  
  <title>MariaDb：基于GTID的主从复制以及基于MaxScale的读写分离 &middot; AzusaArchive</title>
  <meta name="title" content="MariaDb：基于GTID的主从复制以及基于MaxScale的读写分离 &middot; AzusaArchive" />
  
  <meta name="description" content="梓的个人档案" />
  <meta name="keywords" content="MySQL/MariaDb, Docker, 数据库优化, " />
  
  
  <link rel="canonical" href="https://azusaarchive.github.io/Hugo-Blog-Blowfish-Theme/posts/mariadb%E5%9F%BA%E4%BA%8Egtid%E7%9A%84%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/" />
  
  
  
  
  
  
  
  
  
  
  
  
  <link type="text/css" rel="stylesheet" href="/Hugo-Blog-Blowfish-Theme/css/main.bundle.min.80f1ee4035ed37468b46fe8cad6fc4bec8078dd35f849e82cca0e81206a8c89b7b4d11f43aff52899363b906c8cf8417a230d8fceef49879a92934bb934ff2d6.css"
    integrity="sha512-gPHuQDXtN0aLRv6MrW/EvsgHjdNfhJ6CzKDoEgaoyJt7TRH0Ov9SiZNjuQbIz4QXojDY/O70mHmpKTS7k0/y1g==" />
  
  
  <script type="text/javascript" src="/Hugo-Blog-Blowfish-Theme/Hugo-Blog-Blowfish-Theme/js/appearance.min.516a16745bea5a9bd011138d254cc0fd3973cd55ce6e15f3dec763e7c7c2c7448f8fe7b54cca811cb821b0c7e12cd161caace1dd794ac3d34d40937cbcc9ee12.js"
    integrity="sha512-UWoWdFvqWpvQERONJUzA/TlzzVXObhXz3sdj58fCx0SPj&#43;e1TMqBHLghsMfhLNFhyqzh3XlKw9NNQJN8vMnuEg=="></script>
  
  
  
  
  
  
  
  
  
  
  
  
  <script defer type="text/javascript" id="script-bundle" src="/Hugo-Blog-Blowfish-Theme/js/main.bundle.min.34dfb4e6b05b47b0a3599f50035f9bbb18c2d36a26aa4c0ea7acc4936489d4c2a55f65683d53e3c4215337e6a8c02e554881af2da86b5783c96837ae3d4e98f6.js"
    integrity="sha512-NN&#43;05rBbR7CjWZ9QA1&#43;buxjC02omqkwOp6zEk2SJ1MKlX2VoPVPjxCFTN&#43;aowC5VSIGvLahrV4PJaDeuPU6Y9g==" data-copy="" data-copied=""></script>
  
  <script src="/Hugo-Blog-Blowfish-Theme/js/zoom.min.js"></script>
  
  
  <link rel="apple-touch-icon" sizes="180x180" href="/Hugo-Blog-Blowfish-Theme/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="/Hugo-Blog-Blowfish-Theme/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/Hugo-Blog-Blowfish-Theme/favicon-16x16.png" />
  <link rel="manifest" href="/Hugo-Blog-Blowfish-Theme/site.webmanifest" />
  
  
  
  
  
  
  
  <meta property="og:title" content="MariaDb：基于GTID的主从复制以及基于MaxScale的读写分离" />
<meta property="og:description" content="" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://azusaarchive.github.io/Hugo-Blog-Blowfish-Theme/posts/mariadb%E5%9F%BA%E4%BA%8Egtid%E7%9A%84%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/" /><meta property="og:image" content="https://azusaarchive.github.io/Hugo-Blog-Blowfish-Theme/posts/mariadb%E5%9F%BA%E4%BA%8Egtid%E7%9A%84%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/featured.jpg"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-25T15:15:26+08:00" />
<meta property="article:modified_time" content="2023-07-25T15:15:26+08:00" /><meta property="og:site_name" content="AzusaArchive" />


  <meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://azusaarchive.github.io/Hugo-Blog-Blowfish-Theme/posts/mariadb%E5%9F%BA%E4%BA%8Egtid%E7%9A%84%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/featured.jpg"/>
<meta name="twitter:title" content="MariaDb：基于GTID的主从复制以及基于MaxScale的读写分离"/>
<meta name="twitter:description" content=""/>

  
  <script type="application/ld+json">
  [{
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Posts",
    "name": "MariaDb：基于GTID的主从复制以及基于MaxScale的读写分离",
    "headline": "MariaDb：基于GTID的主从复制以及基于MaxScale的读写分离",
    
    
    "inLanguage": "zh-Hans",
    "url" : "https:\/\/azusaarchive.github.io\/Hugo-Blog-Blowfish-Theme\/posts\/mariadb%E5%9F%BA%E4%BA%8Egtid%E7%9A%84%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6\/",
    "author" : {
      "@type": "Person",
      "name": "梓"
    },
    "copyrightYear": "2023",
    "dateCreated": "2023-07-25T15:15:26\u002b08:00",
    "datePublished": "2023-07-25T15:15:26\u002b08:00",
    
    "dateModified": "2023-07-25T15:15:26\u002b08:00",
    
    "keywords": ["MySQL/MariaDb","Docker","数据库优化"],
    
    "mainEntityOfPage": "true",
    "wordCount": "4102"
  }]
  </script>


  
  
  <meta name="author" content="梓" />
  
  
  
  <link href="2817212736@qq.com" rel="me" />
  
  
  <link href="https://github.com/AzusaArchive" rel="me" />
  
  
  
  

<script src="/Hugo-Blog-Blowfish-Theme/lib/jquery/jquery.slim.min.js" integrity=""></script>


















  
  

  
  
  <meta name="theme-color"/>
  
  
</head>
<body
  class="flex flex-col h-screen px-6 m-auto text-lg leading-7 max-w-7xl bg-neutral text-neutral-900 dark:bg-neutral-800 dark:text-neutral sm:px-14 md:px-24 lg:px-32">
  <div id="the-top" class="absolute flex self-center">
    <a class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 focus:translate-y-0 dark:bg-neutral-600"
      href="#main-content"><span
        class="font-bold text-primary-600 ltr:pr-2 rtl:pl-2 dark:text-primary-400">&darr;</span>Skip to main content</a>
  </div>
  
  
  <div class="min-h-[148px]"></div>
<div class="fixed inset-x-0 pl-[24px] pr-[24px]" style="z-index:100">
  <div id="menu-blur" class="absolute opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl shadow-2xl"></div>
  <div class="relative max-w-[64rem] ml-auto mr-auto">
    <div style="padding-left:0;padding-right:0;padding-top:2px;padding-bottom:3px"
    class="main-menu flex items-center justify-between px-4 py-6 sm:px-6 md:justify-start space-x-3">
    
    
    
    <div>
        <a href="/Hugo-Blog-Blowfish-Theme/" class="flex">
            <span class="sr-only">AzusaArchive</span>

            <img src="/Hugo-Blog-Blowfish-Theme/icons/logo.png" width="43" height="40"
                class="logo max-h-[5rem] max-w-[5rem] object-scale-down object-left nozoom" alt="AzusaArchive" />

        </a>
    </div>
    
    <div class="flex flex-1 items-center justify-between">
        <nav class="flex space-x-3">

            <a href="/Hugo-Blog-Blowfish-Theme/" class="text-base font-medium text-gray-500 hover:text-gray-900">AzusaArchive</a>


        </nav>
        <nav class="hidden md:flex items-center space-x-5 md:ml-12 h-12">

            
            
            
  <a href="/Hugo-Blog-Blowfish-Theme/posts/"  class="flex items-center">
    
    <p class="text-base font-medium text-gray-500 hover:text-gray-900" title="Posts">
        文章
    </p>
</a>


            
            
  <a href="/Hugo-Blog-Blowfish-Theme/categories/"  class="flex items-center">
    
    <p class="text-base font-medium text-gray-500 hover:text-gray-900" title="Categories">
        分类
    </p>
</a>


            
            
  <a href="/Hugo-Blog-Blowfish-Theme/tags/"  class="flex items-center">
    
    <p class="text-base font-medium text-gray-500 hover:text-gray-900" title="Tags">
        标签
    </p>
</a>


            
             
  <div>
  <div class="cursor-pointer flex items-center nested-menu">
    
    <a  class="text-base font-medium text-gray-500 hover:text-gray-900" title="">
      其他
    </a>
    <span>
      

  <span class="relative block icon">
    <svg
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 20 20"
  fill="currentColor"
  aria-hidden="true"
>
  <path
    fill-rule="evenodd"
    d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
    clip-rule="evenodd"
  />
</svg>

  </span>


    </span>
  </div>
  <div class="absolute menuhide">
    <div class="pt-2 p-5 mt-2 rounded-xl backdrop-blur shadow-2xl">
      <div class="flex flex-col space-y-3">
        
        <a href="https://github.com/AzusaArchive" 
          target="_blank"  class="flex items-center">
          
          <span  class="mr-1" >
            

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>

  </span>


          </span>
          
          <p class="text-sm font-sm text-gray-500 hover:text-gray-900" title="">
            GitHub
          </p>
        </a>
        
        <a href=""  class="flex items-center">
          
          <span  class="mr-1" >
            

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M172.5 131.1C228.1 75.51 320.5 75.51 376.1 131.1C426.1 181.1 433.5 260.8 392.4 318.3L391.3 319.9C381 334.2 361 337.6 346.7 327.3C332.3 317 328.9 297 339.2 282.7L340.3 281.1C363.2 249 359.6 205.1 331.7 177.2C300.3 145.8 249.2 145.8 217.7 177.2L105.5 289.5C73.99 320.1 73.99 372 105.5 403.5C133.3 431.4 177.3 435 209.3 412.1L210.9 410.1C225.3 400.7 245.3 404 255.5 418.4C265.8 432.8 262.5 452.8 248.1 463.1L246.5 464.2C188.1 505.3 110.2 498.7 60.21 448.8C3.741 392.3 3.741 300.7 60.21 244.3L172.5 131.1zM467.5 380C411 436.5 319.5 436.5 263 380C213 330 206.5 251.2 247.6 193.7L248.7 192.1C258.1 177.8 278.1 174.4 293.3 184.7C307.7 194.1 311.1 214.1 300.8 229.3L299.7 230.9C276.8 262.1 280.4 306.9 308.3 334.8C339.7 366.2 390.8 366.2 422.3 334.8L534.5 222.5C566 191 566 139.1 534.5 108.5C506.7 80.63 462.7 76.99 430.7 99.9L429.1 101C414.7 111.3 394.7 107.1 384.5 93.58C374.2 79.2 377.5 59.21 391.9 48.94L393.5 47.82C451 6.731 529.8 13.25 579.8 63.24C636.3 119.7 636.3 211.3 579.8 267.7L467.5 380z"/></svg>

  </span>


          </span>
          
          <p class="text-sm font-sm text-gray-500 hover:text-gray-900" title="">
            关于
          </p>
        </a>
        
      </div>
    </div>
  </div>
</div>



            
            

            


            
            <button id="search-button" aria-label="Search" class="text-base hover:text-primary-600 dark:hover:text-primary-400 h-12"
                title="">
                

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


            </button>
            


            
            
            <div
                class="ltr:mr-14 rtl:ml-14 cursor-pointer text-sm text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400">
                <button id="appearance-switcher" aria-label="Dark mode switcher" type="button">
                    <div class="flex items-center justify-center h-12 dark:hidden">
                        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>


                    </div>
                    <div class="items-center justify-center hidden h-12 dark:flex">
                        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>


                    </div>
                </button>
            </div>
            

        </nav>
        <div class="flex md:hidden items-center space-x-5 md:ml-12">

            <span></span>

            


            
            <button id="search-button-mobile" aria-label="Search" class="text-base hover:text-primary-600 dark:hover:text-primary-400"
                title="">
                

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


            </button>
            

            
            
            <button id="appearance-switcher-mobile" aria-label="Dark mode switcher" type="button" style="margin-right:5px">
                <div class="flex items-center justify-center h-12 dark:hidden">
                    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>


                </div>
                <div class="items-center justify-center hidden h-12 dark:flex">
                    

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>


                </div>
            </button>
            

        </div>
    </div>
    <div class="-my-2 -mr-2 md:hidden">

        <label id="menu-button" for="menu-controller" class="block">
            <input type="checkbox" id="menu-controller" class="hidden" />
            <div class="cursor-pointer hover:text-primary-600 dark:hover:text-primary-400">
                

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M0 96C0 78.33 14.33 64 32 64H416C433.7 64 448 78.33 448 96C448 113.7 433.7 128 416 128H32C14.33 128 0 113.7 0 96zM0 256C0 238.3 14.33 224 32 224H416C433.7 224 448 238.3 448 256C448 273.7 433.7 288 416 288H32C14.33 288 0 273.7 0 256zM416 448H32C14.33 448 0 433.7 0 416C0 398.3 14.33 384 32 384H416C433.7 384 448 398.3 448 416C448 433.7 433.7 448 416 448z"/></svg>

  </span>


            </div>
            <div id="menu-wrapper" style="padding-top:5px;"
                class="fixed inset-0 z-30 invisible w-screen h-screen m-auto overflow-auto transition-opacity opacity-0 cursor-default bg-neutral-100/50 backdrop-blur-sm dark:bg-neutral-900/50">
                <ul
                    class="flex space-y-2 mt-3 flex-col items-end w-full px-6 py-6 mx-auto overflow-visible list-none ltr:text-right rtl:text-left max-w-7xl">

                    <li>
                        <span
                            class="cursor-pointer inline-block align-text-bottom hover:text-primary-600 dark:hover:text-primary-400">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>

</span>
                    </li>

                    
                    

                    
  <li class="mt-1">
    <a href="/Hugo-Blog-Blowfish-Theme/posts/"  class="flex items-center">
        
        <p class="text-bg font-bg text-gray-500 hover:text-gray-900" title="Posts">
            文章
        </p>
    </a>
</li>



                    

                    
  <li class="mt-1">
    <a href="/Hugo-Blog-Blowfish-Theme/categories/"  class="flex items-center">
        
        <p class="text-bg font-bg text-gray-500 hover:text-gray-900" title="Categories">
            分类
        </p>
    </a>
</li>



                    

                    
  <li class="mt-1">
    <a href="/Hugo-Blog-Blowfish-Theme/tags/"  class="flex items-center">
        
        <p class="text-bg font-bg text-gray-500 hover:text-gray-900" title="Tags">
            标签
        </p>
    </a>
</li>



                    

                     
  <li class="mt-1">
    <a class="flex items-center">
        
        <p class="text-bg font-bg text-gray-500 hover:text-gray-900" title="">
            其他
        </p>
        <span>
            

  <span class="relative block icon">
    <svg
  xmlns="http://www.w3.org/2000/svg"
  viewBox="0 0 20 20"
  fill="currentColor"
  aria-hidden="true"
>
  <path
    fill-rule="evenodd"
    d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z"
    clip-rule="evenodd"
  />
</svg>

  </span>


        </span>
    </a>
</li>

<li class="mt-1">
    <a href="https://github.com/AzusaArchive"  target="_blank"  class="flex items-center">
        
        <span  class="mr-1" >
            

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>

  </span>


        </span>
        
        <p class="text-sm font-small text-gray-500 hover:text-gray-900" title="">
            GitHub
        </p>
    </a>
</li>

<li class="mt-1">
    <a href=""  class="flex items-center">
        
        <span  class="mr-1" >
            

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path fill="currentColor" d="M172.5 131.1C228.1 75.51 320.5 75.51 376.1 131.1C426.1 181.1 433.5 260.8 392.4 318.3L391.3 319.9C381 334.2 361 337.6 346.7 327.3C332.3 317 328.9 297 339.2 282.7L340.3 281.1C363.2 249 359.6 205.1 331.7 177.2C300.3 145.8 249.2 145.8 217.7 177.2L105.5 289.5C73.99 320.1 73.99 372 105.5 403.5C133.3 431.4 177.3 435 209.3 412.1L210.9 410.1C225.3 400.7 245.3 404 255.5 418.4C265.8 432.8 262.5 452.8 248.1 463.1L246.5 464.2C188.1 505.3 110.2 498.7 60.21 448.8C3.741 392.3 3.741 300.7 60.21 244.3L172.5 131.1zM467.5 380C411 436.5 319.5 436.5 263 380C213 330 206.5 251.2 247.6 193.7L248.7 192.1C258.1 177.8 278.1 174.4 293.3 184.7C307.7 194.1 311.1 214.1 300.8 229.3L299.7 230.9C276.8 262.1 280.4 306.9 308.3 334.8C339.7 366.2 390.8 366.2 422.3 334.8L534.5 222.5C566 191 566 139.1 534.5 108.5C506.7 80.63 462.7 76.99 430.7 99.9L429.1 101C414.7 111.3 394.7 107.1 384.5 93.58C374.2 79.2 377.5 59.21 391.9 48.94L393.5 47.82C451 6.731 529.8 13.25 579.8 63.24C636.3 119.7 636.3 211.3 579.8 267.7L467.5 380z"/></svg>

  </span>


        </span>
        
        <p class="text-sm font-small text-gray-500 hover:text-gray-900" title="">
            关于
        </p>
    </a>
</li>

<li class="mb-2"></li>



                    
                    

                </ul>
                

            </div>
        </label>
    </div>
</div>




<script>
    (function () {
        var $mainmenu = $('.main-menu');
        var path = window.location.pathname;
        $mainmenu.find('a[href="' + path + '"]').each(function (i, e) {
            $(e).children('p').addClass('active');
        });
    })();
</script>


  </div>
</div>
<script>
  window.addEventListener('scroll', function (e) {
    var scroll = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
    var background_blur = document.getElementById('menu-blur');
    background_blur.style.opacity = (scroll / 300);
  });
</script>

  
  <div class="relative flex flex-col grow">
    <main id="main-content" class="grow">
      


<article>
  
  
  
  
  
  


<div id="hero" class="h-[150px] md:h-[200px]"></div>


    
    <div class="fixed inset-x-0 top-0 h-[800px] single_hero_background nozoom"
    style="background-image:url(/Hugo-Blog-Blowfish-Theme/posts/mariadb%E5%9F%BA%E4%BA%8Egtid%E7%9A%84%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/featured.jpg);">
    


    <div class="absolute inset-0 bg-gradient-to-t from-neutral dark:from-neutral-800 to-transparent mix-blend-normal">
    </div>
    <div
        class="absolute inset-0 opacity-60 bg-gradient-to-t from-neutral dark:from-neutral-800 to-neutral-100 dark:to-neutral-800 mix-blend-normal">
    </div>
</div>

<div id="background-blur" class="fixed opacity-0 inset-x-0 top-0 h-full single_hero_background nozoom backdrop-blur-2xl"></div>
<script>
    window.addEventListener('scroll', function (e) {
        var scroll = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
        var background_blur = document.getElementById('background-blur');
        background_blur.style.opacity = (scroll / 300)
    });
</script>

  
  

  <header id="single_header" class="mt-5 max-w-prose">
    
    <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
      MariaDb：基于GTID的主从复制以及基于MaxScale的读写分离
    </h1>
    <div class="mt-1 mb-6 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
      




































<div class="flex flex-row flex-wrap items-center">
  
  
  <time datetime="2023-07-25 15:15:26 &#43;0800 CST">2023年7月25日</time><span class="px-2 text-primary-500">&middot;</span><span>4102 字</span><span class="px-2 text-primary-500">&middot;</span><span title="预计阅读">9 分钟</span>
  

  
  
</div>





<div class="flex flex-row flex-wrap items-center">
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/Hugo-Blog-Blowfish-Theme/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/&#34;,'_self');">
    <span class="flex">
  <span
    class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400"
  >
    数据库
  </span>
</span>

  </span>
  
  
  
  
  
  
  
  
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/Hugo-Blog-Blowfish-Theme/tags/mysql/mariadb/&#34;,'_self');">
    <span class="flex">
  <span
    class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400"
  >
    MySQL/MariaDb
  </span>
</span>

  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/Hugo-Blog-Blowfish-Theme/tags/docker/&#34;,'_self');">
    <span class="flex">
  <span
    class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400"
  >
    Docker
  </span>
</span>

  </span>
  
  <span style="margin-top:0.5rem" class="mr-2" onclick="window.open(&#34;/Hugo-Blog-Blowfish-Theme/tags/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BC%98%E5%8C%96/&#34;,'_self');">
    <span class="flex">
  <span
    class="rounded-md border border-primary-400 px-1 py-[1px] text-xs font-normal text-primary-700 dark:border-primary-600 dark:text-primary-400"
  >
    数据库优化
  </span>
</span>

  </span>
  
  
  
  
</div>



    </div>
  </header>
  <section class="flex flex-col max-w-full mt-0 prose dark:prose-invert lg:flex-row">
     <div
      class="order-first sm:max-w-prose lg:ml-auto px-0 lg:order-last lg:max-w-xs ltr:lg:pl-8 rtl:lg:pr-8">
      <div class="toc ltr:pl-5 rtl:pr-5 print:hidden lg:sticky  lg:top-10 ">

         <details open class="mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 hidden lg:block">
  <summary
    class="block py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    Table of Contents
  </summary>
  <div
    class="min-w-[220px] py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#开发环境">开发环境</a></li>
    <li><a href="#mariadb主从复制">MariaDb主从复制</a>
      <ul>
        <li><a href="#概述">概述</a>
          <ul>
            <li><a href="#关于mariadb的主从复制">关于MariaDB的主从复制</a></li>
            <li><a href="#关于全局事务idgtid">关于全局事务ID（GTID）</a></li>
            <li><a href="#官方文档">官方文档</a></li>
          </ul>
        </li>
        <li><a href="#容器准备">容器准备</a>
          <ul>
            <li><a href="#拉取容器">拉取容器</a></li>
            <li><a href="#配置docker-compose">配置Docker Compose</a></li>
          </ul>
        </li>
        <li><a href="#配置mariadb">配置MariaDB</a></li>
        <li><a href="#创建并授权同步账户">创建并授权同步账户</a></li>
        <li><a href="#测试主从复制">测试主从复制</a></li>
      </ul>
    </li>
    <li><a href="#基于maxscale的读写分离">基于MaxScale的读写分离</a>
      <ul>
        <li><a href="#概述-1">概述</a>
          <ul>
            <li><a href="#maxscale">MaxScale</a></li>
          </ul>
        </li>
        <li><a href="#使用maxscale前的数据库配置">使用MaxScale前的数据库配置</a></li>
        <li><a href="#安装maxscale">安装MaxScale</a></li>
        <li><a href="#maxscale配置">MaxScale配置</a></li>
        <li><a href="#maxscale管理页面">MaxScale管理页面</a></li>
        <li><a href="#测试读写分离">测试读写分离</a></li>
      </ul>
    </li>
    <li><a href="#heading"></a></li>
  </ul>
</nav>
  </div>
</details>
<details class="mt-0 overflow-hidden rounded-lg ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 lg:hidden">
  <summary
    class="py-1 text-lg font-semibold cursor-pointer bg-neutral-100 text-neutral-800 ltr:-ml-5 ltr:pl-5 rtl:-mr-5 rtl:pr-5 dark:bg-neutral-700 dark:text-neutral-100 lg:hidden">
    Table of Contents
  </summary>
  <div
    class="py-2 border-dotted border-neutral-300 ltr:-ml-5 ltr:border-l ltr:pl-5 rtl:-mr-5 rtl:border-r rtl:pr-5 dark:border-neutral-600">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#开发环境">开发环境</a></li>
    <li><a href="#mariadb主从复制">MariaDb主从复制</a>
      <ul>
        <li><a href="#概述">概述</a>
          <ul>
            <li><a href="#关于mariadb的主从复制">关于MariaDB的主从复制</a></li>
            <li><a href="#关于全局事务idgtid">关于全局事务ID（GTID）</a></li>
            <li><a href="#官方文档">官方文档</a></li>
          </ul>
        </li>
        <li><a href="#容器准备">容器准备</a>
          <ul>
            <li><a href="#拉取容器">拉取容器</a></li>
            <li><a href="#配置docker-compose">配置Docker Compose</a></li>
          </ul>
        </li>
        <li><a href="#配置mariadb">配置MariaDB</a></li>
        <li><a href="#创建并授权同步账户">创建并授权同步账户</a></li>
        <li><a href="#测试主从复制">测试主从复制</a></li>
      </ul>
    </li>
    <li><a href="#基于maxscale的读写分离">基于MaxScale的读写分离</a>
      <ul>
        <li><a href="#概述-1">概述</a>
          <ul>
            <li><a href="#maxscale">MaxScale</a></li>
          </ul>
        </li>
        <li><a href="#使用maxscale前的数据库配置">使用MaxScale前的数据库配置</a></li>
        <li><a href="#安装maxscale">安装MaxScale</a></li>
        <li><a href="#maxscale配置">MaxScale配置</a></li>
        <li><a href="#maxscale管理页面">MaxScale管理页面</a></li>
        <li><a href="#测试读写分离">测试读写分离</a></li>
      </ul>
    </li>
    <li><a href="#heading"></a></li>
  </ul>
</nav>
  </div>
</details>

 
<script>
  (function () {
    var $toc = $('#TableOfContents');
    if ($toc.length > 0) {
      var $window = $(window);

      function onScroll() {
        var currentScroll = $window.scrollTop();
        var h = $('.anchor');
        var id = "";
        h.each(function (i, e) {
          e = $(e);
          if (e.offset().top - $(window).height()/3 <= currentScroll) {
            id = e.attr('id');
          }
        });
        var active = $toc.find('a.active');      
        if (active.length == 1 && active.eq(0).attr('href') == '#' + id) return true;

        active.each(function (i, e) {
           
            $(e).removeClass('active').siblings('ul').hide();
          
        });
        $toc.find('a[href="#' + id + '"]').addClass('active')
        $toc.find('a[href="#' + id + '"]').parentsUntil('#TableOfContents').each(function (i, e) {
          $(e).children('a').parents('ul').show();          
        });
      }

      $window.on('scroll', onScroll);
      $(document).ready(function () {
         
          $toc.find('a').parent('li').find('ul').hide();
        
        onScroll();
      });
    }
  })();
</script>
   </div>
      </div>
      
      <div class="min-w-0 min-h-0 max-w-prose">
        

        <div id="开发环境" class="anchor"></div>
<h2 class="relative group">开发环境 
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%e5%bc%80%e5%8f%91%e7%8e%af%e5%a2%83" aria-label="锚点">#</a></span>        
    
</h2>
<blockquote>
<ul>
<li>Winodws 10</li>
<li>Docker Desktop (基于WSL2)</li>
<li>Navicat Premium 16</li>
<li>Visual Studio Code</li>
</ul>
</blockquote>
<div id="mariadb主从复制" class="anchor"></div>
<h2 class="relative group">MariaDb主从复制 
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#mariadb%e4%b8%bb%e4%bb%8e%e5%a4%8d%e5%88%b6" aria-label="锚点">#</a></span>        
    
</h2>
<div id="概述" class="anchor"></div>
<h3 class="relative group">概述 
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%e6%a6%82%e8%bf%b0" aria-label="锚点">#</a></span>        
    
</h3>
<div id="关于mariadb的主从复制" class="anchor"></div>
<h4 class="relative group">关于MariaDB的主从复制 
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%e5%85%b3%e4%ba%8emariadb%e7%9a%84%e4%b8%bb%e4%bb%8e%e5%a4%8d%e5%88%b6" aria-label="锚点">#</a></span>        
    
</h4>
<p>MariaDB中主从复制的工作方式如下：<br>
在主库中，所有对数据库的更新（DML和DDL），都将作为<em>binlog事件</em>写入到二进制日志(binlog)中。镜像库（从库）连接到主库并读取其binlog事件，然后在本地应用这些事件，由此来对主库的变更进行复制。一个数据库服务器是可以同时作为主库和从库的，因此二进制日志是可以多级传递的。<br>
镜像库会不断跟踪其主库的binlog偏移量，所以只要主库的binlog没有被删除，从库就能不断同步主库的变更。即使从库停摆或断连，也可以根据断连前记录的偏移量继续对主库进行同步。</p>
<div id="关于全局事务idgtid" class="anchor"></div>
<h4 class="relative group">关于全局事务ID（GTID） 
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%e5%85%b3%e4%ba%8e%e5%85%a8%e5%b1%80%e4%ba%8b%e5%8a%a1idgtid" aria-label="锚点">#</a></span>        
    
</h4>
<p>全局事务ID在二进制日志的事件组（binlog事件的集合，类似于事务）引入了一个新的事件，当一个事件组从主库复制到从库时，就会保存一个GTID，GTID在整个集群中都是全局唯一的，因此可以轻松地在相同的binlog事件中识别不同的从库。</p>
<div id="官方文档" class="anchor"></div>
<h4 class="relative group">官方文档 
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%e5%ae%98%e6%96%b9%e6%96%87%e6%a1%a3" aria-label="锚点">#</a></span>        
    
</h4>
<p><a href="https://mariadb.com/kb/en/gtid/"   target="_blank">
    https://mariadb.com/kb/en/gtid/</a></p>
<hr>
<div id="容器准备" class="anchor"></div>
<h3 class="relative group">容器准备 
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%e5%ae%b9%e5%99%a8%e5%87%86%e5%a4%87" aria-label="锚点">#</a></span>        
    
</h3>
<div id="拉取容器" class="anchor"></div>
<h4 class="relative group">拉取容器 
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%e6%8b%89%e5%8f%96%e5%ae%b9%e5%99%a8" aria-label="锚点">#</a></span>        
    
</h4>
<p>首先在docker中拉取MariaDB镜像，这里的版本使用10.11.4</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">docker pull mariadb:10.11.4
</span></span></code></pre></div><div id="配置docker-compose" class="anchor"></div>
<h4 class="relative group">配置Docker Compose 
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%e9%85%8d%e7%bd%aedocker-compose" aria-label="锚点">#</a></span>        
    
</h4>
<p>这里使用一主一从作为数据库集群，为方便测试，在同一台机器上运行，并用<a href="https://docs.docker.com/compose/compose-file/"   target="_blank">
    Docker Compose</a>编排。<br>
主库容器名为 mariadb-master，从库容器名为 mariadb-slave01<br>
分别暴露3308和3309端口，并使用环境变量的方式配置mariadb默认用户(root)的密码。</p>
<p>compose.yaml:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;2.18.1&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">services</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">mariadb-master</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">mariadb:10.11.4</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;3308:3306&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">MariaDb_Master:/etc/mysql 		#配置</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">MariaDb_Master:/var/lib/mysql 	#数据</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">MariaDb_Master:/var/log/mysql 	#日志</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">MYSQL_ROOT_PASSWORD=123456</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">mariadb-slave01</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">mariadb:10.11.4</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;3309:3306&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">MariaDb_Slave01:/etc/mysql 		#配置</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">MariaDb_Slave01:/var/lib/mysql 	#数据</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">MariaDb_Slave01:/var/log/mysql 	#日志</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">MYSQL_ROOT_PASSWORD=123465</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">MariaDb_Master</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">MariaDb_Slave01</span><span class="p">:</span><span class="w">
</span></span></span></code></pre></div><p>运行docker-compose，项目名为 <em>maria-cluster</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">docker-compose -p maria-cluster up
</span></span></code></pre></div><p>结果如下所示





  
  
  
    <figure>
      <img class="my-0 rounded-md" src="./docker-compose.png" alt="docker-compose" />
      <figcaption>docker-compose</figcaption>
    </figure>
  

</p>
<hr>
<div id="配置mariadb" class="anchor"></div>
<h3 class="relative group">配置MariaDB 
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%e9%85%8d%e7%bd%aemariadb" aria-label="锚点">#</a></span>        
    
</h3>
<p>示例中的环境为基于WSL2的docker，使用 <strong>VSCode+Dev Containers</strong> 插件来更方便地访问容器中的文件。





  
  
  
    <figure>
      <img class="my-0 rounded-md" src="./dev%20containers.png" alt="dev containers" />
      <figcaption>dev containers</figcaption>
    </figure>
  

</p>
<p>




  
  
  
    <figure>
      <img class="my-0 rounded-md" src="./connect-to-container.png" alt="连接到容器" />
      <figcaption>连接到容器</figcaption>
    </figure>
  

</p>
<p>打开VSCode并连接到容器 <strong>mariadb-master</strong> ，对主库进行配置<br>
打开<code>/etc/mysql/</code>下的<code>my.cnf</code>文件，对其添加内容：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ini" data-lang="ini"><span class="line"><span class="cl"><span class="k">[mysqld]</span>
</span></span><span class="line"><span class="cl"><span class="c1">#服务器ID</span>
</span></span><span class="line"><span class="cl"><span class="na">server_id</span> <span class="o">=</span> <span class="s">11</span>
</span></span><span class="line"><span class="cl"><span class="c1">#启用二进制日志</span>
</span></span><span class="line"><span class="cl"><span class="na">log_bin</span> <span class="o">=</span> <span class="s">mysql-bin</span>
</span></span><span class="line"><span class="cl"><span class="c1">#binlog过期天数</span>
</span></span><span class="line"><span class="cl"><span class="na">expire_logs_days</span> <span class="o">=</span> <span class="s">30</span>
</span></span><span class="line"><span class="cl"><span class="c1">#表名不区分大小写</span>
</span></span><span class="line"><span class="cl"><span class="na">lower_case_table_names</span> <span class="o">=</span> <span class="s">1 </span>
</span></span><span class="line"><span class="cl"><span class="c1">#二进制日志文件格式</span>
</span></span><span class="line"><span class="cl"><span class="na">binlog_format</span> <span class="o">=</span> <span class="s">ROW</span>
</span></span><span class="line"><span class="cl"><span class="c1">#将主从复制期间从库接收到的更新记录到从库的二进制日志中（链式复制），从库首先也要开启二进制记录此项配置才能生效</span>
</span></span><span class="line"><span class="cl"><span class="na">log_slave_updates</span> <span class="o">=</span> <span class="s">1</span>
</span></span><span class="line"><span class="cl"><span class="c1">#复制的数据库将会在设定次数的事务后进行同步，如果设置为0，则依赖于操作系统刷新</span>
</span></span><span class="line"><span class="cl"><span class="na">sync_master_info</span> <span class="o">=</span> <span class="s">1</span>
</span></span><span class="line"><span class="cl"><span class="c1">#从库并行复制线程</span>
</span></span><span class="line"><span class="cl"><span class="na">slave_parallel_threads</span> <span class="o">=</span> <span class="s">3</span>
</span></span><span class="line"><span class="cl"><span class="c1">#启用主库效验</span>
</span></span><span class="line"><span class="cl"><span class="na">master_verify_checksum</span> <span class="o">=</span> <span class="s">1</span>
</span></span><span class="line"><span class="cl"><span class="c1">#指定对于二进制日志的校验类型</span>
</span></span><span class="line"><span class="cl"><span class="na">binlog_checksum</span> <span class="o">=</span> <span class="s">CRC32</span>
</span></span><span class="line"><span class="cl"><span class="c1">#启用从库效验</span>
</span></span><span class="line"><span class="cl"><span class="na">slave_sql_verify_checksum</span> <span class="o">=</span> <span class="s">1</span>
</span></span></code></pre></div><p>连接到容器 <strong>mariadb-slave01</strong>，对从库进行配置<br>
同样打开<code>/etc/mysql/</code>下的<code>my.cnf</code>文件，对齐添加内容：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ini" data-lang="ini"><span class="line"><span class="cl"><span class="c1">#此数据库为从库01</span>
</span></span><span class="line"><span class="cl"><span class="k">[mysqld]</span>
</span></span><span class="line"><span class="cl"><span class="c1">#服务器ID</span>
</span></span><span class="line"><span class="cl"><span class="na">server_id</span><span class="o">=</span><span class="s">12</span>
</span></span><span class="line"><span class="cl"><span class="c1">#启用二进制日志</span>
</span></span><span class="line"><span class="cl"><span class="na">log-bin</span><span class="o">=</span> <span class="s">mysql-bin </span>
</span></span><span class="line"><span class="cl"><span class="c1">#从库中继日志名</span>
</span></span><span class="line"><span class="cl"><span class="na">relay_log</span> <span class="o">=</span> <span class="s">relay-bin</span>
</span></span><span class="line"><span class="cl"><span class="c1">#表名不区分大小写</span>
</span></span><span class="line"><span class="cl"><span class="na">lower_case_table_names</span> <span class="o">=</span> <span class="s">1</span>
</span></span></code></pre></div><blockquote>
<p>配置可根据需求自定义，详见<a href="https://mariadb.com/kb/en/replication-and-binary-log-system-variables"   target="_blank">
    Binlog System Variables</a></p>
</blockquote>
<hr>
<div id="创建并授权同步账户" class="anchor"></div>
<h3 class="relative group">创建并授权同步账户 
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%e5%88%9b%e5%bb%ba%e5%b9%b6%e6%8e%88%e6%9d%83%e5%90%8c%e6%ad%a5%e8%b4%a6%e6%88%b7" aria-label="锚点">#</a></span>        
    
</h3>
<p>使用Navicat（或其他方式），连接到Docker中的主库（<strong>localhost:3308</strong>）并创建账号：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">GRANT</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">PRIVILEGES</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="o">*</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">dbsync</span><span class="w"> </span><span class="o">@</span><span class="s1">&#39;%&#39;</span><span class="w"> </span><span class="n">IDENTIFIED</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="s1">&#39;123456&#39;</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>上述命令会创建名为 <em>&ldquo;dbsync&rdquo;</em> 的用户，密码为 123456，并在所有数据库中拥有所有权限。</p>
<p>使用<code>FLUSH PRIVILEGES</code>命令刷新权限，然后查看MASTER的状态：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SHOW</span><span class="w"> </span><span class="n">MASTER</span><span class="w"> </span><span class="n">STATUS</span><span class="w">
</span></span></span></code></pre></div><p>将得到类似以下的信息，记录了二进制日志以及其偏移量：</p>
<table>
<thead>
<tr>
<th>File</th>
<th>Position</th>
<th>Binlog_Do_DB</th>
<th>Binlog_Ignore_DB</th>
</tr>
</thead>
<tbody>
<tr>
<td>mysql-bin.000005</td>
<td>626</td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>根据这些日志文件名和偏移量可查看此时Master的GTID：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SELECT</span><span class="w"> </span><span class="n">BINLOG_GTID_POS</span><span class="p">(</span><span class="s1">&#39;mysql-bin.000005&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">626</span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><table>
<thead>
<tr>
<th>BINLOG_GTID_POST(&lsquo;mysql-bin.000005&rsquo;,626)</th>
</tr>
</thead>
<tbody>
<tr>
<td>0-11-2</td>
</tr>
</tbody>
</table>
<p>接着同步账号到从库（<strong>localhost:3309</strong>）：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SET</span><span class="w"> </span><span class="k">GLOBAL</span><span class="w"> </span><span class="n">gtid_slave_pos</span><span class="o">=</span><span class="s2">&#34;0-11-2&#34;</span><span class="p">;</span><span class="w"> </span><span class="c1">-- 配置gtid
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">CHANGE</span><span class="w"> </span><span class="n">MASTER</span><span class="w"> </span><span class="k">TO</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c1">-- 跨容器访问
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">MASTER_HOST</span><span class="o">=</span><span class="s2">&#34;mariadb-master&#34;</span><span class="p">,</span><span class="w"> </span><span class="c1">-- 主库HOST
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">MASTER_PORT</span><span class="o">=</span><span class="mi">3306</span><span class="p">,</span><span class="w"> </span><span class="c1">-- 主库端口
</span></span></span><span class="line"><span class="cl"><span class="c1">-- 使用刚才创建的账户远程连接主库
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">MASTER_USER</span><span class="o">=</span><span class="s2">&#34;dbsync&#34;</span><span class="p">,</span><span class="w"> </span><span class="c1">-- 在主库中创建的用户名
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">MASTER_PASSWORD</span><span class="o">=</span><span class="s2">&#34;123456&#34;</span><span class="p">,</span><span class="w"> </span><span class="c1">-- 密码
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">MASTER_LOG_FILE</span><span class="o">=</span><span class="s2">&#34;mysql-bin.000006&#34;</span><span class="p">,</span><span class="w"> </span><span class="c1">-- 刚才得到的二进制日志名
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">MASTER_LOG_POS</span><span class="o">=</span><span class="mi">342</span><span class="p">,</span><span class="w"> </span><span class="c1">-- 二进制日志偏移量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">MASTER_USE_GTID</span><span class="o">=</span><span class="n">slave_pos</span><span class="p">;</span><span class="w"> </span><span class="c1">-- 在GTID 模式下复制并使用gtid_slave_pos作为位置开始从主数据库下载事务
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">START</span><span class="w"> </span><span class="n">SLAVE</span><span class="p">;</span><span class="w"> </span><span class="c1">-- 开启从库
</span></span></span></code></pre></div><blockquote>
<p>对于 <code>CHANGE MASTER TO</code> 的更多配置，参考<a href="https://mariadb.com/kb/en/change-master-to/"   target="_blank">
    Change Master To</a></p>
</blockquote>
<p>查看从库状态：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SHOW</span><span class="w"> </span><span class="n">SLAVE</span><span class="w"> </span><span class="n">STATUS</span><span class="w">
</span></span></span></code></pre></div><p>




  
  
  
    <figure>
      <img class="my-0 rounded-md" src="./show%20slave%20status.png" alt="从库状态" />
      <figcaption>从库状态</figcaption>
    </figure>
  

</p>
<p>可以看到<code>Slave_IO_Running</code>和<code>Slave_SQL_Running</code>两项为YES，并且<code>Slave_IO_State</code>为&quot;正在等待主库发送事件&quot;，即代表主从复制配置成功。</p>
<hr>
<div id="测试主从复制" class="anchor"></div>
<h3 class="relative group">测试主从复制 
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%e6%b5%8b%e8%af%95%e4%b8%bb%e4%bb%8e%e5%a4%8d%e5%88%b6" aria-label="锚点">#</a></span>        
    
</h3>
<p>在主库中建立一个测试数据库<br>





  
  
  
    <figure>
      <img class="my-0 rounded-md" src="./test_db.png" alt="测试数据库" />
      <figcaption>建立数据库测试</figcaption>
    </figure>
  

</p>
<p>随便导入一段数据库结构进行测试<br>





  
  
  
    <figure>
      <img class="my-0 rounded-md" src="./import%20sql.png" alt="导入SQL" />
      <figcaption>导入SQL</figcaption>
    </figure>
  

</p>
<p>刷新从库，发现数据库已从主库同步<br>





  
  
  
    <figure>
      <img class="my-0 rounded-md" src="./slave%20test_db.png" alt="同步从库" />
      <figcaption>同步从库</figcaption>
    </figure>
  

</p>
<p>对主库插入几条数据进行测试：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="o">`</span><span class="k">order</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">`</span><span class="n">OrderNo</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">CreateTime</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">CompanyID</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">SchduleDeliveryDate</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">OrderType</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">OrderSort</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">CadDataType</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">Deleted</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">ProcessState</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">IsBatch</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">ShardKey</span><span class="o">`</span><span class="w"> </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">VALUES</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">(</span><span class="w"> </span><span class="mi">20220104020855</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2022-01-04 10:06:46&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1455</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;0001-01-01 00:00:00&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">22010</span><span class="w"> </span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="o">`</span><span class="k">order</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">`</span><span class="n">OrderNo</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">CreateTime</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">CompanyID</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">SchduleDeliveryDate</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">OrderType</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">OrderSort</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">CadDataType</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">Deleted</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">ProcessState</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">IsBatch</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">ShardKey</span><span class="o">`</span><span class="w"> </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">VALUES</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">(</span><span class="w"> </span><span class="mi">20220104020856</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2022-01-04 14:18:42&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1455</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;0001-01-01 00:00:00&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">22010</span><span class="w"> </span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="o">`</span><span class="k">order</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">`</span><span class="n">OrderNo</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">CreateTime</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">CompanyID</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">SchduleDeliveryDate</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">OrderType</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">OrderSort</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">CadDataType</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">Deleted</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">ProcessState</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">IsBatch</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">ShardKey</span><span class="o">`</span><span class="w"> </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">VALUES</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">(</span><span class="w"> </span><span class="mi">20220104020857</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2022-01-04 14:32:35&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1455</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;0001-01-01 00:00:00&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">22010</span><span class="w"> </span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="o">`</span><span class="k">order</span><span class="o">`</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="o">`</span><span class="n">OrderNo</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">CreateTime</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">CompanyID</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">SchduleDeliveryDate</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">OrderType</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">OrderSort</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">CadDataType</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">Deleted</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">ProcessState</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">IsBatch</span><span class="o">`</span><span class="p">,</span><span class="w"> </span><span class="o">`</span><span class="n">ShardKey</span><span class="o">`</span><span class="w"> </span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">VALUES</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">	</span><span class="p">(</span><span class="w"> </span><span class="mi">20220104020858</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;2022-01-04 15:08:22&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1455</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;0001-01-01 00:00:00&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">838</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">22010</span><span class="w"> </span><span class="p">);</span><span class="w">
</span></span></span></code></pre></div><p>可知从库已从主库同步：





  
  
  
    <figure>
      <img class="my-0 rounded-md" src="./data%20insert.png" alt="插入数据" />
      <figcaption>主库插入的数据已被从库同步</figcaption>
    </figure>
  

</p>
<div id="基于maxscale的读写分离" class="anchor"></div>
<h2 class="relative group">基于MaxScale的读写分离 
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%e5%9f%ba%e4%ba%8emaxscale%e7%9a%84%e8%af%bb%e5%86%99%e5%88%86%e7%a6%bb" aria-label="锚点">#</a></span>        
    
</h2>
<div id="概述-1" class="anchor"></div>
<h3 class="relative group">概述 
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%e6%a6%82%e8%bf%b0-1" aria-label="锚点">#</a></span>        
    
</h3>
<div id="maxscale" class="anchor"></div>
<h4 class="relative group">MaxScale 
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#maxscale" aria-label="锚点">#</a></span>        
    
</h4>
<p>MaxScale是MariaDb的一个数据库代理中间件，它将数据库语句转发到一个或多个数据库服务器。<br>
MaxScale为应用程序提供负载均衡以及各种高可用性功能，通过将它与MariaDb底层数据库架构分离来简化应用程序开发。</p>
<div id="使用maxscale前的数据库配置" class="anchor"></div>
<h3 class="relative group">使用MaxScale前的数据库配置 
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%e4%bd%bf%e7%94%a8maxscale%e5%89%8d%e7%9a%84%e6%95%b0%e6%8d%ae%e5%ba%93%e9%85%8d%e7%bd%ae" aria-label="锚点">#</a></span>        
    
</h3>
<p>在主库中创建MaxScale的认证用户</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">USER</span><span class="w"> </span><span class="s1">&#39;maxscale&#39;</span><span class="o">@</span><span class="s1">&#39;%&#39;</span><span class="w"> </span><span class="n">IDENTIFIED</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="s1">&#39;123456&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GRANT</span><span class="w"> </span><span class="k">SELECT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="o">`</span><span class="n">mysql</span><span class="o">`</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="s1">&#39;maxscale&#39;</span><span class="o">@</span><span class="s1">&#39;%&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GRANT</span><span class="w"> </span><span class="k">SHOW</span><span class="w"> </span><span class="n">DATABASES</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="o">*</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="s1">&#39;maxscale&#39;</span><span class="o">@</span><span class="s1">&#39;%&#39;</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>在主库中创建MaxScale的监控账号</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">USER</span><span class="w"> </span><span class="s1">&#39;maxscale_monitor&#39;</span><span class="w"> </span><span class="o">@</span><span class="s1">&#39;%&#39;</span><span class="w"> </span><span class="n">IDENTIFIED</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="s1">&#39;123456&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GRANT</span><span class="w"> </span><span class="n">REPLICATION</span><span class="w"> </span><span class="n">CLIENT</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="o">*</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="s1">&#39;maxscale_monitor&#39;</span><span class="w"> </span><span class="o">@</span><span class="s1">&#39;%&#39;</span><span class="p">;</span><span class="w"> </span><span class="c1">-- 复制客户端用于监控复制过程
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">GRANT</span><span class="w"> </span><span class="n">REPLICATION</span><span class="w"> </span><span class="n">SLAVE</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="o">*</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="s1">&#39;maxscale_monitor&#39;</span><span class="w"> </span><span class="o">@</span><span class="s1">&#39;%&#39;</span><span class="p">;</span><span class="w">  </span><span class="c1">-- 从库复制权限
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">GRANT</span><span class="w"> </span><span class="n">SUPER</span><span class="p">,</span><span class="n">RELOAD</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="o">*</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="s1">&#39;maxscale_monitor&#39;</span><span class="w"> </span><span class="o">@</span><span class="s1">&#39;%&#39;</span><span class="p">;</span><span class="w">       </span><span class="c1">-- SUPER和RELOAD权限用于自动故障转移
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">GRANT</span><span class="w"> </span><span class="k">SHOW</span><span class="w"> </span><span class="n">DATABASES</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="o">*</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="s1">&#39;maxscale_monitor&#39;</span><span class="w"> </span><span class="o">@</span><span class="s1">&#39;%&#39;</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><p>在主库中创建MaxScale连接账号</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">USER</span><span class="w"> </span><span class="s1">&#39;azusa&#39;</span><span class="w"> </span><span class="o">@</span><span class="s1">&#39;%&#39;</span><span class="w"> </span><span class="n">IDENTIFIED</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="s1">&#39;123456&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GRANT</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">PRIVILEGES</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="o">*</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="s1">&#39;azusa&#39;</span><span class="w"> </span><span class="o">@</span><span class="s1">&#39;%&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">FLUSH</span><span class="w"> </span><span class="k">PRIVILEGES</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></div><blockquote>
<p>即应用程序通过MaxScale连接MariaDb所用的账号，用户名为&rsquo;azusa&rsquo;，密码为'123456&rsquo;</p>
</blockquote>
<div id="安装maxscale" class="anchor"></div>
<h3 class="relative group">安装MaxScale 
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%e5%ae%89%e8%a3%85maxscale" aria-label="锚点">#</a></span>        
    
</h3>
<p>在Docker中拉取MaxScale</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">docker pull mariadb/maxscale:23.02
</span></span></code></pre></div><p>修改Docker Compose，将MaxScale服务加入</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;2.18.1&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">services</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">mariadb-master</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">mariadb:10.11.4</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;3308:3306&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">MariaDb_Master:/etc/mysql 		#配置</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">MariaDb_Master:/var/lib/mysql 	#数据</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">MariaDb_Master:/var/log/mysql 	#日志</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">MYSQL_ROOT_PASSWORD=20020816</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">mariadb-slave01</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">mariadb:10.11.4</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;3309:3306&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">MariaDb_Slave01:/etc/mysql 		#配置</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">MariaDb_Slave01:/var/lib/mysql 	#数据</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">MariaDb_Slave01:/var/log/mysql 	#日志</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">MYSQL_ROOT_PASSWORD=20020816</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">maxscale</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">mariadb/maxscale:23.02</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;4008:4008&#34;</span><span class="w"> </span><span class="c"># 配置4008端口用于读取</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;4006:4006&#34;</span><span class="w"> </span><span class="c"># 配置4006端口用读写</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;8989:8989&#34;</span><span class="w"> </span><span class="c"># 配置8989端口用于访问MaxScale GUI</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">MaxScale_Conf:/etc/maxscale.cnf.d</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">TZ=Asia/Shanghai</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">MariaDb_Master</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">MariaDb_Slave01</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">MaxScale_Conf</span><span class="p">:</span><span class="w">
</span></span></span></code></pre></div><p><code>compose up</code>运行容器，即可启用MaxScale。</p>
<div id="maxscale配置" class="anchor"></div>
<h3 class="relative group">MaxScale配置 
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#maxscale%e9%85%8d%e7%bd%ae" aria-label="锚点">#</a></span>        
    
</h3>
<p>使用VSCode远程连接到MaxScale容器，在 <code>/etc/maxscale.cnf.d</code> 目录下新建一个配置文件 <code>my-maxscale.cnf</code> 对MaxScale进行配置</p>
<p>my-maxscale.cnf:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-ini" data-lang="ini"><span class="line"><span class="cl"><span class="c1"># https://mariadb.com/kb/en/mariadb-maxscale-24-mariadb-maxscale-configuration-guide/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 定义数据库后端服务</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 主库</span>
</span></span><span class="line"><span class="cl"><span class="k">[server1]</span>
</span></span><span class="line"><span class="cl"><span class="na">type</span><span class="o">=</span><span class="s">server</span>
</span></span><span class="line"><span class="cl"><span class="na">address</span><span class="o">=</span><span class="s">mariadb-master</span>
</span></span><span class="line"><span class="cl"><span class="na">port</span><span class="o">=</span><span class="s">3306</span>
</span></span><span class="line"><span class="cl"><span class="na">protocol</span><span class="o">=</span><span class="s">MariaDBBackend</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 从库1</span>
</span></span><span class="line"><span class="cl"><span class="k">[server2]</span>
</span></span><span class="line"><span class="cl"><span class="na">type</span><span class="o">=</span><span class="s">server</span>
</span></span><span class="line"><span class="cl"><span class="na">address</span><span class="o">=</span><span class="s">mariadb-slave01</span>
</span></span><span class="line"><span class="cl"><span class="na">port</span><span class="o">=</span><span class="s">3306</span>
</span></span><span class="line"><span class="cl"><span class="na">protocol</span><span class="o">=</span><span class="s">MariaDBBackend</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># MaxScale监控模块，能够自动判断主从，完成自动故障转移的操作（需要授予权限）</span>
</span></span><span class="line"><span class="cl"><span class="c1"># https://github.com/mariadb-corporation/MaxScale/blob/2.3/Documentation/Monitors/MariaDB-Monitor.md</span>
</span></span><span class="line"><span class="cl"><span class="k">[MariaDb-Monitor]</span>
</span></span><span class="line"><span class="cl"><span class="na">type</span><span class="o">=</span><span class="s">monitor</span>
</span></span><span class="line"><span class="cl"><span class="na">module</span><span class="o">=</span><span class="s">mariadbmon</span>
</span></span><span class="line"><span class="cl"><span class="na">servers</span><span class="o">=</span><span class="s">server1,server2</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 使用创建的maxscale监控用户登入</span>
</span></span><span class="line"><span class="cl"><span class="na">user</span><span class="o">=</span><span class="s">maxscale_monitor</span>
</span></span><span class="line"><span class="cl"><span class="na">password</span><span class="o">=</span><span class="s">123456</span>
</span></span><span class="line"><span class="cl"><span class="na">monitor_interval</span><span class="o">=</span><span class="s">60000ms</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 强制从库只读</span>
</span></span><span class="line"><span class="cl"><span class="c1">; enforce_read_only_slaves=1</span>
</span></span><span class="line"><span class="cl"><span class="na">auto_failover</span><span class="o">=</span><span class="s">true</span>
</span></span><span class="line"><span class="cl"><span class="na">auto_rejoin</span><span class="o">=</span><span class="s">true</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 负载均衡服务</span>
</span></span><span class="line"><span class="cl"><span class="k">[Read-Only-Service]</span>
</span></span><span class="line"><span class="cl"><span class="na">type</span><span class="o">=</span><span class="s">service</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 只读</span>
</span></span><span class="line"><span class="cl"><span class="na">router</span><span class="o">=</span><span class="s">readconnroute  </span>
</span></span><span class="line"><span class="cl"><span class="na">servers</span><span class="o">=</span><span class="s">server2         </span>
</span></span><span class="line"><span class="cl"><span class="c1"># 使用maxscale认证用户登入</span>
</span></span><span class="line"><span class="cl"><span class="na">user</span><span class="o">=</span><span class="s">maxscale           </span>
</span></span><span class="line"><span class="cl"><span class="na">password</span><span class="o">=</span><span class="s">123456</span>
</span></span><span class="line"><span class="cl"><span class="na">router_options</span><span class="o">=</span><span class="s">slave</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 读写分离服务</span>
</span></span><span class="line"><span class="cl"><span class="c1"># https://mariadb.com/kb/en/mariadb-maxscale-2302-readwritesplit/</span>
</span></span><span class="line"><span class="cl"><span class="c1"># MaxScale通过监控模块获取服务器主从信息，自动把读取类语句转发给从库，写入类语句转发给主库。</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 修改变量类的操作将发送到所有服务器。</span>
</span></span><span class="line"><span class="cl"><span class="k">[Read-Write-Service]</span>
</span></span><span class="line"><span class="cl"><span class="na">type</span><span class="o">=</span><span class="s">service</span>
</span></span><span class="line"><span class="cl"><span class="na">router</span><span class="o">=</span><span class="s">readwritesplit</span>
</span></span><span class="line"><span class="cl"><span class="na">servers</span><span class="o">=</span><span class="s">server1,server2</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 使用maxscale认证用户登入</span>
</span></span><span class="line"><span class="cl"><span class="na">user</span><span class="o">=</span><span class="s">maxscale           </span>
</span></span><span class="line"><span class="cl"><span class="na">password</span><span class="o">=</span><span class="s">123456</span>
</span></span><span class="line"><span class="cl"><span class="na">filters</span><span class="o">=</span><span class="s">Hint</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 主库崩溃后所有写入操作返回错误，进入只读模式（没有设置此项默认是断开MaxScale连接）</span>
</span></span><span class="line"><span class="cl"><span class="na">master_failure_mode</span><span class="o">=</span><span class="s">error_on_write</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 如果一个从库被提升为主库，启用此项可以让数据库会话自动重连</span>
</span></span><span class="line"><span class="cl"><span class="na">master_reconnection</span><span class="o">=</span><span class="s">true</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># MaxScale Hint</span>
</span></span><span class="line"><span class="cl"><span class="k">[Hint]</span>
</span></span><span class="line"><span class="cl"><span class="na">type</span><span class="o">=</span><span class="s">filter</span>
</span></span><span class="line"><span class="cl"><span class="na">module</span><span class="o">=</span><span class="s">hintfilter</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># 监听器</span>
</span></span><span class="line"><span class="cl"><span class="c1"># 使用定义的服务并暴露端口</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">[Read-Only-Listener]</span>
</span></span><span class="line"><span class="cl"><span class="na">type</span><span class="o">=</span><span class="s">listener</span>
</span></span><span class="line"><span class="cl"><span class="na">service</span><span class="o">=</span><span class="s">Read-Only-Service</span>
</span></span><span class="line"><span class="cl"><span class="na">protocol</span><span class="o">=</span><span class="s">MariaDBClient</span>
</span></span><span class="line"><span class="cl"><span class="na">port</span><span class="o">=</span><span class="s">4008</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">[Read-Write-Listener]</span>
</span></span><span class="line"><span class="cl"><span class="na">type</span><span class="o">=</span><span class="s">listener</span>
</span></span><span class="line"><span class="cl"><span class="na">service</span><span class="o">=</span><span class="s">Read-Write-Service</span>
</span></span><span class="line"><span class="cl"><span class="na">protocol</span><span class="o">=</span><span class="s">MariaDBClient</span>
</span></span><span class="line"><span class="cl"><span class="na">port</span><span class="o">=</span><span class="s">4006</span>
</span></span></code></pre></div><blockquote>
<p><strong>MaxScale读写分离</strong><br>
数据库管理工具可通过暴露的读写分离端口（4006）来连接到MaxScale服务（连接方式和MariaDb一样）<br>
MaxScale通过读取 <em>&ldquo;mysql&rdquo;</em> 数据库中的信息来自动判断定义的数据库后端服务的主从状态，接着把读取类型的语句转发给从库，而写入类型的语句转发给主库，从而实现读写分离。
关于更多MaxScale读写分离服务的配置参考：<a href="https://mariadb.com/kb/en/mariadb-maxscale-2302-readwritesplit/"   target="_blank">
    ReadWriteSplit</a></p>
</blockquote>
<blockquote>
<p><strong>关于MaxScale自动故障转移</strong> <br>
假设当前有三台服务器：A(主，写)，B(从，读)，C(从，读)，若A服务器崩溃时，会立刻将一个从库服务器提升为新的主库。<br>
要实现自动故障转移首先需要启用MaxScale监控模块并配置自动故障转移，同时从库的也需要开启二进制日志和中继日志。并且需要设定GTID，避免从库的数据不同步。</p>
</blockquote>
<p>重启maxscale容器，访问 <code>/var/log/maxscale/maxscale.log</code> 文件可查看MaxScale日志，确认没有异常后即可进行MaxScale的测试。</p>
<div id="maxscale管理页面" class="anchor"></div>
<h3 class="relative group">MaxScale管理页面 
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#maxscale%e7%ae%a1%e7%90%86%e9%a1%b5%e9%9d%a2" aria-label="锚点">#</a></span>        
    
</h3>
<p>MaxScale 2.5 版本后，即可通过访问容器的8989端口进入MaxScale的GUI管理页面，其内部使用MaxCtrl命令行对MaxScale进行实时监控和配置。</p>
<p>在Docker Compose中已经暴露了容器的8989端口，所以直接访问<a href="localhost:8989"  >
    localhost:8989</a>进入MaxScale GUI页面：</p>
<p>




  
  
  
    <figure>
      <img class="my-0 rounded-md" src="./maxscale%20gui.png" alt="MaxScale GUI" />
      <figcaption>MaxScale GUI</figcaption>
    </figure>
  

</p>
<p>MaxGUI的用户认证与MaxCtrl一致，默认的用户名和密码是<strong>admin</strong>和<strong>mariadb</strong>。
MaxGUI可实时监控并管理MaxScale的状态：





  
  
  
    <figure>
      <img class="my-0 rounded-md" src="./maxscale%20admin.png" alt="MaxScale Admin" />
      <figcaption>MaxScale Admin</figcaption>
    </figure>
  

</p>
<blockquote>
<p>MaxGUI指南: <a href="https://mariadb.com/kb/en/mariadb-maxscale-25-mariadb-maxscale-maxgui-guide/"   target="_blank">
    https://mariadb.com/kb/en/mariadb-maxscale-25-mariadb-maxscale-maxgui-guide/</a><br>
MaxCtrl: <a href="https://mariadb.com/kb/en/mariadb-maxscale-2302-maxctrl/"   target="_blank">
    https://mariadb.com/kb/en/mariadb-maxscale-2302-maxctrl/</a></p>
</blockquote>
<div id="测试读写分离" class="anchor"></div>
<h3 class="relative group">测试读写分离 
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#%e6%b5%8b%e8%af%95%e8%af%bb%e5%86%99%e5%88%86%e7%a6%bb" aria-label="锚点">#</a></span>        
    
</h3>
<p>因为此时开启了主从复制，所以两个数据库的数据都是同步的，没法从数据层面直接看出读写分离，但可以通过开启MariaDb全局日志的形式查看主库和从库执行的语句。<br>
对所有的数据库执行下面的语句：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SET</span><span class="w"> </span><span class="k">GLOBAL</span><span class="w"> </span><span class="n">general_log</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">ON</span><span class="p">;</span><span class="c1">-- 开启全局日志日志
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SET</span><span class="w"> </span><span class="k">GLOBAL</span><span class="w"> </span><span class="n">general_log_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;/tmp/general.log&#39;</span><span class="p">;</span><span class="c1">-- 设置日志文件保存位置
</span></span></span></code></pre></div><blockquote>
<p>容器重启后General Log会自动关闭</p>
</blockquote>
<p>其他General Log常用的语句：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">SHOW</span><span class="w"> </span><span class="n">VARIABLES</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;general_log&#39;</span><span class="p">;</span><span class="c1">-- 查看全局日志是否开启
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SET</span><span class="w"> </span><span class="k">GLOBAL</span><span class="w"> </span><span class="n">general_log</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">ON</span><span class="p">;</span><span class="c1">-- 开启全局日志
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SHOW</span><span class="w"> </span><span class="n">VARIABLES</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;general_log_file&#39;</span><span class="p">;</span><span class="c1">-- 查看全局日志文件保存位置
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SET</span><span class="w"> </span><span class="k">GLOBAL</span><span class="w"> </span><span class="n">general_log_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;/tmp/general.log&#39;</span><span class="p">;</span><span class="c1">-- 设置全局日志文件保存位置
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SHOW</span><span class="w"> </span><span class="n">VARIABLES</span><span class="w"> </span><span class="k">LIKE</span><span class="w"> </span><span class="s1">&#39;log_output&#39;</span><span class="p">;</span><span class="c1">-- 查看日志输出类型 table或file
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SET</span><span class="w"> </span><span class="k">GLOBAL</span><span class="w"> </span><span class="n">log_output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;table&#39;</span><span class="p">;</span><span class="c1">-- 设置输出类型为 table
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">SET</span><span class="w"> </span><span class="k">GLOBAL</span><span class="w"> </span><span class="n">log_output</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;file&#39;</span><span class="p">;</span><span class="c1">-- 设置输出类型为file
</span></span></span></code></pre></div><p>开启General Log后，即可通过查看保存路径下的日志开测试读写分离。<br>
打开Navicat（或其他方式），使用刚刚创建的用户 &lsquo;azusa&rsquo;-&lsquo;123456&rsquo; 连接到MaxScale(4006端口)。<br>
执行一段查询语句，然后查看日志文件，发现从库执行了语句：





  
  
  
    <figure>
      <img class="my-0 rounded-md" src="./read%20action.png" alt="读取操作" />
      <figcaption>左侧为主库，右侧为从库1</figcaption>
    </figure>
  

</p>
<p>执行一段插入语句，然后查看日志文件，发现主库执行了语句：





  
  
  
    <figure>
      <img class="my-0 rounded-md" src="./write%20action.png" alt="写入操作" />
      <figcaption>左侧为主库，右侧为从库1</figcaption>
    </figure>
  

</p>
<p>可见MaxScale成功进行了读写分离。</p>
<hr>
<div id="heading" class="anchor"></div>
<h2 class="relative group"> 
    <span
        class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100">
        <a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700"
            style="text-decoration-line: none !important;" href="#heading" aria-label="锚点">#</a></span>        
    
</h2>
<blockquote>
<p>参考文章
How to Install and Configure MaxScale for MariaDB: <a href="https://severalnines.com/blog/how-install-and-configure-maxscale-mariadb/"   target="_blank">
    https://severalnines.com/blog/how-install-and-configure-maxscale-mariadb/</a><br>
ariaDB主从复制+MaxScale读写分离和自动化故障转移: <a href="https://www.somata.top/2020/mariadb_and_maxscale_cluster.html"   target="_blank">
    https://www.somata.top/2020/mariadb_and_maxscale_cluster.html</a><br>
基于GTID的MariaDB主从复制: <a href="https://blog.csdn.net/weixin_34192732/article/details/93077543"   target="_blank">
    https://blog.csdn.net/weixin_34192732/article/details/93077543</a><br>
探讨EF Core如何优雅的实现读写分离: <a href="https://www.cnblogs.com/alphayu/p/14241406.html"   target="_blank">
    https://www.cnblogs.com/alphayu/p/14241406.html</a><br>
ANDC: <a href="https://github.com/AlphaYu/adnc"   target="_blank">
    https://github.com/AlphaYu/adnc</a></p>
</blockquote>

        </br></br>
        

      </div>
     
     <script>
        var oid = "views_posts\\MariaDB：基于GTID的主从复制\\index.md"
        var oid_likes = "likes_posts\\MariaDB：基于GTID的主从复制\\index.md"
      </script>
      
      
      <script type="text/javascript" src="/Hugo-Blog-Blowfish-Theme/js/page.min.0e49973b4ad0a382c7c6012d8bff8226316642daabc4f8a20477bd08674f3da6e2fa993bc20ad4f51e7c5bb68e6f913a207a7c4fe37ea0e7b806894afce0a64e.js" integrity="sha512-DkmXO0rQo4LHxgEti/&#43;CJjFmQtqrxPiiBHe9CGdPPabi&#43;pk7wgrU9R58W7aOb5E6IHp8T&#43;N&#43;oOe4BolK/OCmTg=="></script>
  
    </section>
  <footer class="pt-8 max-w-prose print:hidden">

    
  <div class="flex">
    
      
      
        
        <img
          class="!mt-0 !mb-0 h-24 w-24 rounded-full ltr:mr-4 rtl:ml-4"
          width="96"
          height="96"
          alt="梓"
          src="/Hugo-Blog-Blowfish-Theme/icons/author_huc7c5f53e7a7e442840bc7322fda3a490_146602_192x192_fill_q75_box_center.jpg"
        />
      
    
    <div class="place-self-center">
      
        <div class="text-[0.6rem] uppercase leading-3 text-neutral-500 dark:text-neutral-400">
          作者
        </div>
        <div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">
          梓
        </div>
      
      
        <div class="text-sm text-neutral-700 dark:text-neutral-400">沉舟侧畔千帆过，病树前头万木春</div>
      
      <div class="text-2xl sm:text-lg">
  <div class="flex flex-wrap text-neutral-400 dark:text-neutral-500">
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="2817212736@qq.com"
          target="_blank"
          aria-label="Email"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1c-27.64 140.9 68.65 266.2 199.1 285.1c19.01 2.888 36.17-12.26 36.17-31.49l.0001-.6631c0-15.74-11.44-28.88-26.84-31.24c-84.35-12.98-149.2-86.13-149.2-174.2c0-102.9 88.61-185.5 193.4-175.4c91.54 8.869 158.6 91.25 158.6 183.2l0 16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98 .0036c-7.299 0-13.2 4.992-15.12 11.68c-24.85-12.15-54.24-16.38-86.06-5.106c-38.75 13.73-68.12 48.91-73.72 89.64c-9.483 69.01 43.81 128 110.9 128c26.44 0 50.43-9.544 69.59-24.88c24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3C495.1 107.1 361.2-9.332 207.8 20.73zM239.1 304.3c-26.47 0-48-21.56-48-48.05s21.53-48.05 48-48.05s48 21.56 48 48.05S266.5 304.3 239.1 304.3z"/></svg>

  </span>

</span></a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://github.com/AzusaArchive"
          target="_blank"
          aria-label="Github"
          rel="me noopener noreferrer"
          ><span class="inline-block align-text-bottom">

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>

  </span>

</span></a
        >
      
    
  </div>

</div>
    </div>
  </div>



    
    
    

    

    

    
  
  <section class="flex flex-row flex-wrap justify-center pt-4 text-xl">
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="https://twitter.com/intent/tweet/?url=https://azusaarchive.github.io/Hugo-Blog-Blowfish-Theme/posts/mariadb%E5%9F%BA%E4%BA%8Egtid%E7%9A%84%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/&amp;text=MariaDb%ef%bc%9a%e5%9f%ba%e4%ba%8eGTID%e7%9a%84%e4%b8%bb%e4%bb%8e%e5%a4%8d%e5%88%b6%e4%bb%a5%e5%8f%8a%e5%9f%ba%e4%ba%8eMaxScale%e7%9a%84%e8%af%bb%e5%86%99%e5%88%86%e7%a6%bb"
      title="分享到 Twitter"
      aria-label="分享到 Twitter"
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>

  </span>


    </a>
      
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="https://reddit.com/submit/?url=https://azusaarchive.github.io/Hugo-Blog-Blowfish-Theme/posts/mariadb%E5%9F%BA%E4%BA%8Egtid%E7%9A%84%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/&amp;resubmit=true&amp;title=MariaDb%ef%bc%9a%e5%9f%ba%e4%ba%8eGTID%e7%9a%84%e4%b8%bb%e4%bb%8e%e5%a4%8d%e5%88%b6%e4%bb%a5%e5%8f%8a%e5%9f%ba%e4%ba%8eMaxScale%e7%9a%84%e8%af%bb%e5%86%99%e5%88%86%e7%a6%bb"
      title="提交到 Reddit"
      aria-label="提交到 Reddit"
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M201.5 305.5c-13.8 0-24.9-11.1-24.9-24.6 0-13.8 11.1-24.9 24.9-24.9 13.6 0 24.6 11.1 24.6 24.9 0 13.6-11.1 24.6-24.6 24.6zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-132.3-41.2c-9.4 0-17.7 3.9-23.8 10-22.4-15.5-52.6-25.5-86.1-26.6l17.4-78.3 55.4 12.5c0 13.6 11.1 24.6 24.6 24.6 13.8 0 24.9-11.3 24.9-24.9s-11.1-24.9-24.9-24.9c-9.7 0-18 5.8-22.1 13.8l-61.2-13.6c-3-.8-6.1 1.4-6.9 4.4l-19.1 86.4c-33.2 1.4-63.1 11.3-85.5 26.8-6.1-6.4-14.7-10.2-24.1-10.2-34.9 0-46.3 46.9-14.4 62.8-1.1 5-1.7 10.2-1.7 15.5 0 52.6 59.2 95.2 132 95.2 73.1 0 132.3-42.6 132.3-95.2 0-5.3-.6-10.8-1.9-15.8 31.3-16 19.8-62.5-14.9-62.5zM302.8 331c-18.2 18.2-76.1 17.9-93.6 0-2.2-2.2-6.1-2.2-8.3 0-2.5 2.5-2.5 6.4 0 8.6 22.8 22.8 87.3 22.8 110.2 0 2.5-2.2 2.5-6.1 0-8.6-2.2-2.2-6.1-2.2-8.3 0zm7.7-75c-13.6 0-24.6 11.1-24.6 24.9 0 13.6 11.1 24.6 24.6 24.6 13.8 0 24.9-11.1 24.9-24.6 0-13.8-11-24.9-24.9-24.9z"/></svg>

  </span>


    </a>
      
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="https://www.facebook.com/sharer/sharer.php?u=https://azusaarchive.github.io/Hugo-Blog-Blowfish-Theme/posts/mariadb%E5%9F%BA%E4%BA%8Egtid%E7%9A%84%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/&amp;quote=MariaDb%ef%bc%9a%e5%9f%ba%e4%ba%8eGTID%e7%9a%84%e4%b8%bb%e4%bb%8e%e5%a4%8d%e5%88%b6%e4%bb%a5%e5%8f%8a%e5%9f%ba%e4%ba%8eMaxScale%e7%9a%84%e8%af%bb%e5%86%99%e5%88%86%e7%a6%bb"
      title="分享到 Facebook"
      aria-label="分享到 Facebook"
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg>

  </span>


    </a>
      
    
      
      <a
      target="_blank"
      class="m-1 rounded bg-neutral-300 p-1.5 text-neutral-700 hover:bg-primary-500 hover:text-neutral dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800"
      href="mailto:?body=https://azusaarchive.github.io/Hugo-Blog-Blowfish-Theme/posts/mariadb%E5%9F%BA%E4%BA%8Egtid%E7%9A%84%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/&amp;subject=MariaDb%ef%bc%9a%e5%9f%ba%e4%ba%8eGTID%e7%9a%84%e4%b8%bb%e4%bb%8e%e5%a4%8d%e5%88%b6%e4%bb%a5%e5%8f%8a%e5%9f%ba%e4%ba%8eMaxScale%e7%9a%84%e8%af%bb%e5%86%99%e5%88%86%e7%a6%bb"
      title="通过电子邮件发送"
      aria-label="通过电子邮件发送"
      >
      

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1c-27.64 140.9 68.65 266.2 199.1 285.1c19.01 2.888 36.17-12.26 36.17-31.49l.0001-.6631c0-15.74-11.44-28.88-26.84-31.24c-84.35-12.98-149.2-86.13-149.2-174.2c0-102.9 88.61-185.5 193.4-175.4c91.54 8.869 158.6 91.25 158.6 183.2l0 16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98 .0036c-7.299 0-13.2 4.992-15.12 11.68c-24.85-12.15-54.24-16.38-86.06-5.106c-38.75 13.73-68.12 48.91-73.72 89.64c-9.483 69.01 43.81 128 110.9 128c26.44 0 50.43-9.544 69.59-24.88c24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3C495.1 107.1 361.2-9.332 207.8 20.73zM239.1 304.3c-26.47 0-48-21.56-48-48.05s21.53-48.05 48-48.05s48 21.56 48 48.05S266.5 304.3 239.1 304.3z"/></svg>

  </span>


    </a>
      
    
  </section>



    

    
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600" />
      <div class="flex justify-between pt-3">
        <span>
          
            <a class="flex group mr-3" href="/Hugo-Blog-Blowfish-Theme/posts/%E4%BD%BF%E7%94%A8xunit%E7%BC%96%E5%86%99%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95/">
              <span
                class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400"
                >&larr;</span
              >
              <span
                class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >使用xUnit编写单元测试</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2023-07-12 11:28:47 &#43;0800 CST">2023年7月12日</time>
                  
                </span>
              </span>
            </a>
          
        </span>
        <span>
          
            <a class="flex text-right group ml-3" href="/Hugo-Blog-Blowfish-Theme/posts/csharp-%E5%BC%82%E6%AD%A5%E4%BB%A3%E7%A0%81%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9/">
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >C# 异步代码注意事项</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2023-08-28 15:13:45 &#43;0800 CST">2023年8月28日</time>
                  
                </span>
              </span>
              <span
                class="ml-3 text-neutral-700 group-hover:text-primary-600 ltr:inline rtl:hidden dark:text-neutral dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span
                class="mr-3 text-neutral-700 group-hover:text-primary-600 ltr:hidden rtl:inline dark:text-neutral dark:group-hover:text-primary-400"
                >&larr;</span
              >
            </a>
          
        </span>
      </div>
    </div>
  


    
  </footer>
</article>

      <div id="top-scroller" class="pointer-events-none absolute top-[110vh] bottom-0 w-12 ltr:right-0 rtl:left-0">
  <a href="#the-top"
    class="pointer-events-auto sticky top-[calc(100vh-5.5rem)] flex h-12 w-12 mb-16 items-center justify-center rounded-full bg-neutral/50 text-xl text-neutral-700 backdrop-blur hover:text-primary-600 dark:bg-neutral-800/50 dark:text-neutral dark:hover:text-primary-400"
    aria-label="Scroll to top" title="Scroll to top">
    &uarr;
  </a>
</div>
    </main><footer id="site-footer" class="py-10 print:hidden">
  
  
    
  
  <div class="flex items-center justify-between">

    
    
    <p class="text-sm text-neutral-500 dark:text-neutral-400">
      Copy, <em>right?</em> 🤔
    </p>
    

    
    
    <p class="text-xs text-neutral-500 dark:text-neutral-400">
      
      
      由 <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
        href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> &amp; <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
        href="https://blowfish.page/" target="_blank" rel="noopener noreferrer">Blowfish</a> 强力驱动
    </p>
    

  </div>
  <script>
    
    mediumZoom(document.querySelectorAll("img:not(.nozoom)"), {
      margin: 24,
      background: 'rgba(0,0,0,0.5)',
      scrollOffset: 0,
    })
    
  </script>
  
  
  <script type="text/javascript" src="/Hugo-Blog-Blowfish-Theme/js/process.min.35c1113bcc16c5a59bf031082f9e63822aa95280423881a7847a7ff33a16e6299ce6a840d9ef4e10d947e030a18f3f20359afb2ec0f35967484b9a9360ac3145.js" integrity="sha512-NcERO8wWxaWb8DEIL55jgiqpUoBCOIGnhHp/8zoW5imc5qhA2e9OENlH4DChjz8gNZr7LsDzWWdIS5qTYKwxRQ=="></script>
  
  
</footer><div
  id="search-wrapper"
  class="invisible fixed inset-0 flex h-screen w-screen cursor-default flex-col bg-neutral-500/50 p-4 backdrop-blur-sm dark:bg-neutral-900/50 sm:p-6 md:p-[10vh] lg:p-[12vh]"
  data-url="https://azusaarchive.github.io/Hugo-Blog-Blowfish-Theme/"
  style="z-index:500"
>
  <div
    id="search-modal"
    class="flex flex-col w-full max-w-3xl min-h-0 mx-auto border rounded-md shadow-lg top-20 border-neutral-200 bg-neutral dark:border-neutral-700 dark:bg-neutral-800"
  >
    <header class="relative z-10 flex items-center justify-between flex-none px-2">
      <form class="flex items-center flex-auto min-w-0">
        <div class="flex items-center justify-center w-8 h-8 text-neutral-400">
          

  <span class="relative block icon">
    <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="search" class="svg-inline--fa fa-search fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M505 442.7L405.3 343c-4.5-4.5-10.6-7-17-7H372c27.6-35.3 44-79.7 44-128C416 93.1 322.9 0 208 0S0 93.1 0 208s93.1 208 208 208c48.3 0 92.7-16.4 128-44v16.3c0 6.4 2.5 12.5 7 17l99.7 99.7c9.4 9.4 24.6 9.4 33.9 0l28.3-28.3c9.4-9.4 9.4-24.6.1-34zM208 336c-70.7 0-128-57.2-128-128 0-70.7 57.2-128 128-128 70.7 0 128 57.2 128 128 0 70.7-57.2 128-128 128z"/></svg>

  </span>


        </div>
        <input
          type="search"
          id="search-query"
          class="flex flex-auto h-12 mx-1 bg-transparent appearance-none focus:outline-dotted focus:outline-2 focus:outline-transparent"
          placeholder="Search"
          tabindex="0"
        />
      </form>
      <button
        id="close-search-button"
        class="flex items-center justify-center w-8 h-8 text-neutral-700 hover:text-primary-600 dark:text-neutral dark:hover:text-primary-400"
        title="Close (Esc)"
      >
        

  <span class="relative block icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><path fill="currentColor" d="M310.6 361.4c12.5 12.5 12.5 32.75 0 45.25C304.4 412.9 296.2 416 288 416s-16.38-3.125-22.62-9.375L160 301.3L54.63 406.6C48.38 412.9 40.19 416 32 416S15.63 412.9 9.375 406.6c-12.5-12.5-12.5-32.75 0-45.25l105.4-105.4L9.375 150.6c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0L160 210.8l105.4-105.4c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25l-105.4 105.4L310.6 361.4z"/></svg>

  </span>


      </button>
    </header>
    <section class="flex-auto px-2 overflow-auto">
      <ul id="search-results">
        
      </ul>
    </section>
  </div>
</div>

  </div>
</body>

</html>
